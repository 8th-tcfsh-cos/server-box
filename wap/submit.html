<!DOCTYPE html>
<html lang="zh">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" /> -->

    <link rel='stylesheet prefetch' href='https://fonts.googleapis.com/icon?family=Material+Icons'>
    <link rel='stylesheet prefetch' href='https://fonts.googleapis.com/css?family=Roboto:300'>
    <!-- <link rel="stylesheet" href="/files/fonts.css"/> -->


    <!-- Bootstrap CSS -->
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> -->

    <title>表單</title>

    <link rel="shortcut icon" type="image/png" href="/favicon.png"/>
    <meta name="theme-color" content="#AB47BC">

    <link rel="stylesheet" href="/files/material.teal-blue.min.css"/>
    <link rel="stylesheet" href="/files/material-components-web.min.css"/>
    <!-- <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-blue.min.css"/> -->
    <!-- <link rel="stylesheet" href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css"/> -->


    <link rel="stylesheet" href="/files/bootstrap.css" media="screen">
    <link rel="stylesheet" href="/files/custom.min.css">
    <link rel="stylesheet" href="/files/style.css?v=1.1">
    <link rel="stylesheet" href="./wap.css?v=1.1">
    <!-- <link rel="stylesheet" href="https://bootswatch.com/4/darkly/bootstrap.min.css"> -->

    <!-- Nice fonts -->
    <link href="https://fonts.googleapis.com/css?family=Josefin+Sans" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Share+Tech" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lilita+One" rel="stylesheet">
</head>

<body id="body">
    <div id="top-bar"></div>

    <div id="drawer"></div>

    <div class="page-content">

        <div class="section-header clearfix" id="title">
            <div class="row">
                <div class="col-lg-12">
                    <div class="page-header">
                        成發意見箱
                    </div>
                </div>
            </div>
        </div>

        <br>

        <div id="status">
        </div>

        <!-- for debugging purposes -->
        <!-- <button class="mat-button mdc-button--raised mdc-button" onClick="showOverlay()">Open</button> -->

        <div id="tmp-success" style="display: none;">
            <div id="submitted" class="alert alert-dismissible alert-primary">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                已成功提交您的建議。
            </div>
        </div>

        <div id="tmp-error" style="display: none;">
            <div id="n-submitted" class="alert alert-dismissible alert-danger">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                無法提交表單，伺服器傳回以下錯誤：
                <br>
                <div id="error-log">
                    <!-- for error log -->
                </div>
            </div>
        </div>

        <form id="sub-form" action="process-submission.php" method="post" enctype="multipart/form-data">
            <br>
            <p>
                如果你對於台中一中 0822 的成果發表會有任何的建議或想法，你可以透過以下表單來提交，並請儘量讓你的想法易懂且有建設性。<strong>與提交內容對應的組別或工作人員擁有決定是否採納該建議的最終權利。</strong>
                <!-- 如果你對於台中一中 0822 的成果發表會有任何的建議或想法，你可以透過以下表單來提交。投稿者不限於 0822 的同學，但請儘量讓你的想法易懂且有建設性。<strong>與提交內容對應的組別或工作人員擁有決定是否採納該建議的最終權利。</strong> -->
            </p>
            <div class="form-group">
                <div class="mdc-text-field mdc-text-field--outlined" id="yourname-container" style="width: 100%">
                    <input name="name" id="yourname" class="mdc-text-field__input" style="width: 100%" autocomplete="off" required="true" onInput="onTextChange(this)">
                    <label for="yourname" class="mdc-floating-label">你的名字</label>
                    <!-- <i class="material-icons mdc-text-field-icon mdc-text-field__icon" tabindex="0" role="button" onClick="document.getElementById('yourname').value='';">delete</i> -->
                    <div class="mdc-notched-outline">
                        <svg>
                            <path class="mdc-notched-outline__path"/>
                        </svg>
                    </div>
                    <div class="mdc-notched-outline__idle"></div>
                </div>
                <!-- <div class="text-field-container" style="width: 100%;">
                    <div class="mdc-text-field mdc-text-field--upgraded mdc-text-field--multiline" style="width: 100%">
                        <input type="text" id="text-field-name"  rows="8" class="mdc-text-field__input"/>
                        <label class="mdc-floating-label" for="text-field-name">你的名字</label>
                        <div class="mdc-line-ripple" style="transform-origin: 92.5px center 0px;"></div>
                    </div>
                </div> -->
            </div>
            <div class="form-group">
                <!-- <hr class="sep"> -->
                <label class="description-label">收件者是?&nbsp;(多選)</label>
                <div class="toggle-button-group">
                    <button type="button" id="group-btn1" class="mat-button mdc-button mdc-button--outlined   red-button purple-button" onClick="select_group(this)" style="margin-bottom: 3px">美術組</button>
                    <button type="button" id="group-btn0" class="mat-button mdc-button mdc-button--outlined orange-button purple-button" onClick="select_group(this)" style="margin-bottom: 3px">總副召</button>
                    <button type="button" id="group-btn6" class="mat-button mdc-button mdc-button--outlined yellow-button purple-button" onClick="select_group(this)" style="margin-bottom: 3px">音樂組</button>
                    <button type="button" id="group-btn3" class="mat-button mdc-button mdc-button--outlined green-button purple-button" onClick="select_group(this)" style="margin-bottom: 3px">影片組</button>
                    <button type="button" id="group-btn4" class="mat-button mdc-button mdc-button--outlined blue-button purple-button" onClick="select_group(this)" style="margin-bottom: 3px">文宣組</button>
                    <button type="button" id="group-btn2" class="mat-button mdc-button mdc-button--outlined purple-button purple-button" onClick="select_group(this)" style="margin-bottom: 3px">公關組</button>
                    <button type="button" id="group-btn5" class="mat-button mdc-button mdc-button--outlined pink-button purple-button" onClick="select_group(this)" style="margin-bottom: 3px">活動組</button>
                    <button type="button" id="group-btn7" class="mat-button mdc-button mdc-button--outlined brown-button purple-button" onClick="select_group(this)" style="margin-bottom: 3px">其他人</button>
                </div>
                <input class="form-control" name="groups" id="groups" type="text" placeholder="Invisible input here…" style="display: none"></input>
                <span class="mdc-form-field form-group">
                    <div class="mdc-checkbox">
                        <input type="checkbox" class="mdc-checkbox__native-control" id="color-switch" onChange="toggle_color(this.checked);"/>
                        <div class="mdc-checkbox__background">
                            <svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
                                <path class="mdc-checkbox__checkmark-path" fill="none" d="M1.73,12.91 8.1,19.28 22.79,4.59"/>
                            </svg>
                            <div class="mdc-checkbox__mixedmark"></div>
                        </div>
                    </div>
                    <label class="checkbox-label" for="color-switch">
                        彩虹
                    </label>
                </span>
            </div>
            <div class="form-group">
                <!-- <hr class="sep"> -->
                <!-- <label for="yoursub">提交內容<span class="text-danger"> *</span></label>
                <textarea class="form-control" name="submission" id="yoursub" style="margin-top: 0px; margin-bottom: 0px; height: 150px;" maxlength="4096" placeholder="輸入文字" required onInput="onTextChange(this)"></textarea>
                <small class="form-text text-muted">
                    (電腦版)從右下角可以調整文字框大小。
                </small> -->
                <!-- <div class="mdc-text-field mdc-text-field--textarea">
                    <textarea id="textarea" class="mdc-text-field__input"></textarea>
                    <label for="textarea" class="mdc-floating-label">提交內容</label>
                </div> -->
                <div class="mdc-text-field text-field mdc-text-field--fullwidth mdc-text-field--textarea mdc-text-field--upgraded" id="yoursub-container">
                    <textarea name="submission" id="yoursub" class="mdc-text-field__input" required onInput="onTextChange(this)"></textarea>
                    <label class="mdc-floating-label" for="yoursub">提交內容</label>
                    <!-- <i class="material-icons mdc-text-field__icon" data-mdc-tooltip="你的投稿內容" role="img" tabindex="0">info</i> -->
                </div>
            </div>
            <!-- <p>
                另外，你也可以選擇上傳一個檔案。僅接受文件格式(.pdf, .docx, etc)或圖片(.png, .tiff, etc)。若檔案大小超過限制，你可以將它上傳到雲端儲存空間並把連結給我們。
            </p> -->
            <div class="form-group">
                <!-- <hr class="sep"> -->
                <!-- <input type="file" name="File Upload" class="form-control fileupload"> -->
                <!-- <label for="upload">&nbsp;No file chosen</label> -->
                <!-- <label for="file-upload1" class="custom-file-upload">
                    Custom Upload
                </label> -->
                <label class="description-label">你可以上傳大小 &leq;20MiB 的檔案，若有多個檔案請壓縮成一包後再上傳。</label>
                <br>
                <span>
                    <label id="upload-button1" for="file-upload1" class="mat-button mdc-button mdc-button--raised gray-button">選擇檔案</label>
                    <input id="file-upload1" name="attachment" type="file" class="file-upload form-control" onChange="uploadOnChange(this)" style="display: none;"/>
                    <label id="filename1" style="position: relative;"></label>
                </span>
                <!-- <small class="form-text">
                    <span class="text-muted">
                        選擇要上傳的檔案，檔案大小上限為 1MiB。
                    </span>
                    <span class="text-warning">
                        此功能目前在實驗階段。
                    </span>
                </small> -->
            </div>
            <!-- hidden for now -->

            <div class="form-group recaptcha-container">
                <div class="g-recaptcha" data-theme="dark" data-size="normal" data-sitekey="6LeAqGkUAAAAAD81DFKbkAC-bgP1MYS5Tq3HQS9n">
                </div>
            </div>
            <!-- <div class="form-group">
                <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="agree" required>
                    <label class="custom-control-label" for="agree" style="font-size: 0.9375rem;">我已詳讀並同意<a href="terms_of_use.html" target="_blank">使用者條款</a>及<a href="privacy_policy.html" target="_blank">隱私權政策</a>。<span class="text-danger"> *</span></label>
                </div>
            </div> -->
            <div class="form-group">
                <button id="submit-button" type="button" class="mat-button mdc-button mdc-button--raised purple-button" onClick="sendForm()">送出</button>
                <!-- &nbsp; -->
                <button id="reset-button" type="button" class="mat-button mdc-button mdc-button--raised gray-button" onClick="resetForm()">清除</button>
            </div>
        </form>

        <footer id="footer">
            <!-- will be loaded using javascript -->
        </footer>

    </div>

    <aside id="confirm-submission-dialog" class="mdc-dialog mdc-elevation--z6">
        <div class="mdc-dialog__surface">
            <header class="mdc-dialog__header">
                <h2 id="confirm-submission-dialog-label" class="mdc-dialog__header__title">
                    確認上傳
                </h2>
            </header>
            <section id="confirm-submission-dialog-description" class="mdc-dialog__body">
                確定要提交這些內容?
            </section>
            <footer class="mdc-dialog__footer">
                <button type="button" class="mat-button mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept" onclick="$('#sub-form').submit()">確定</button>
                <button type="button" class="mat-button mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel">取消</button>
            </footer>
        </div>
        <div class="mdc-dialog__backdrop"></div>
    </aside>

    <aside id="form-incomplete-dialog" class="mdc-dialog mdc-elevation--z6">
        <div class="mdc-dialog__surface">
            <header class="mdc-dialog__header">
                <h2 id="form-incomplete-dialog-label" class="mdc-dialog__header__title">
                    表單未完成
                </h2>
            </header>
            <section id="form-incomplete-dialog-description" class="mdc-dialog__body">
                請確認你有正確的填完此表單。
            </section>
            <footer class="mdc-dialog__footer">
                <button type="button" class="mat-button mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept">確定</button>
            </footer>
        </div>
        <div class="mdc-dialog__backdrop"></div>
    </aside>

    <aside id="not-robot-dialog" class="mdc-dialog mdc-dialog mdc-elevation--z6">
        <div class="mdc-dialog__surface">
            <header class="mdc-dialog__header">
                <h2 id="not-robot-dialog-label" class="mdc-dialog__header__title">
                    你484機器人?
                </h2>
            </header>
            <section id="not-robot-dialog-description" class="mdc-dialog__body">
                就算是也請按「我不是機器人」。
            </section>
            <footer class="mdc-dialog__footer">
                <button type="button" class="mat-button mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept">4</button>
                <button type="button" class="mat-button mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel">84</button>
            </footer>
        </div>
        <div class="mdc-dialog__backdrop"></div>
    </aside>

    <div id="sending-overlay" class="overlay" style="height: 0%; width: 100%;">
        <!-- <a href="javascript:void(0)" class="overlay-closebtn" onclick="closePost(0)">&times;</a> -->
        <div class="overlay-content">
            <p>
                資料傳送中
            </p>
            <!-- progress bar -->
            <div id="sending-bar">

            </div>
            <div role="progressbar" class="mdc-linear-progress mdc-linear-progress--indeterminate">
                <div class="mdc-linear-progress__buffering-dots"></div>
                <div class="mdc-linear-progress__buffer"></div>
                <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">
                    <span class="mdc-linear-progress__bar-inner"></span>
                </div>
                <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">
                    <span class="mdc-linear-progress__bar-inner"></span>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="/files/jquery.min.js"></script>
    <script type="text/javascript" src="/files/build.js?v=1"></script>

    <script type="text/javascript" src="/files/popper.min.js"></script>
    <script type="text/javascript" src="/files/bootstrap.min.js"></script>


    <!-- <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script> -->
    <script defer src="/files/material-components-web.min.js"></script>
    <!-- <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script> -->
    <!-- <script defer src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script> -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> -->

    <!-- recaptcha -->
    <script src='https://www.google.com/recaptcha/api.js?hl=zh-TW'></script>

    <script>
        // preventing enter key from submitting the form
        $(document).on("keypress", ":input:not(textarea)", function(event) {
            return event.keyCode != 13;
        });

        function showOverlay() {
            // show 'sending form' overlay
            st = document.getElementById("sending-overlay").style;
            st.height = "100%";

            // const bar = $('.mdc-linear-progress')[0];
            //
            // // const MDCLinearProgress = new mdc.linearProgress.MDCLinearProgress;
            // // const MDCLinearProgressFoundation = new mdc.linearProgress.MDCLinearProgressFoundation;
            //
            // const progress = new mdc.linearProgress.MDCLinearProgress(bar);
            //
            // // progressFoundation.setDeterminate(false);
            // progress.progress = 1;

            // $('#sending-bar')[0].innerHTML = $('#loading-bar')[0].innerHTML;
        }

        function closeOverlay() {
            st = document.getElementById("sending-overlay").style;
            st.height = "0%";
        }

        // update custom file button
        function uploadOnChange(e) {
            var upload_button = document.getElementById('upload-button1');
            if(e.value == ""){
                // document.getElementById('filename1').innerHTML = "沒有東西";
                document.getElementById('filename1').innerHTML = "";
                upload_button.innerHTML = "選擇檔案";
                upload_button.className = "mat-button mdc-button mdc-button--raised gray-button";
                mdc.ripple.MDCRipple.attachTo(upload_button);
                return false;
            }

            if(e.files[0].size > 1048576 * 20){
                document.getElementById('filename1').innerHTML = "檔案過大! 你可以改為將其上傳到別的地方並把連結貼在文字框內。";
                upload_button.innerHTML = "選擇檔案";
                upload_button.className = "mat-button mdc-button mdc-button--raised red-button";
                mdc.ripple.MDCRipple.attachTo(upload_button);
                e.value = "";
                return false;
            };

            var filename = e.value;
            var lastIndex = filename.lastIndexOf("\\");
            if (lastIndex >= 0) {
                filename = filename.substring(lastIndex +1);
                document.getElementById('filename1').innerHTML = filename;
                upload_button.innerHTML = "換一個檔案";
                upload_button.className = "mat-button mdc-button mdc-button--raised green-button";
                mdc.ripple.MDCRipple.attachTo(upload_button);
            }
        }

        function onTextChange(e) {
            var a = new mdc.textField.MDCTextField(document.querySelector('#' + e.id + '-container'));
            if(e.value.trim() == "") {
                a.valid = false;
            }else{
                if(e.id == "yoursub") {
                    a.valid = e.value.length >= 20;
                } else {
                    a.valid = true;
                }
            }
        }

        function showRules(){
            var rules_dialog = new mdc.dialog.MDCDialog(document.querySelector('#rules-dialog'));
            rules_dialog.show();
        }

        // js for validating required fields
        function validate() {
            var valid = true;
            var name = document.getElementById('yourname').value;
            var subm = document.getElementById('yoursub').value;
            if(name.trim() == "" || name == null){
                document.getElementById('yourname').value = "";
                valid = false;
                var a = new mdc.textField.MDCTextField(document.querySelector('#yourname-container'));
                a.valid = false;
                // document.getElementById('yourname').className = "";
            }
            if(subm.trim() == "" || subm == null){
                document.getElementById('yoursub').value = "";
                valid = false;
                // set text field style
                var b = new mdc.textField.MDCTextField(document.querySelector('#yoursub-container'));
                b.valid = false;
                // document.getElementById('yoursub').className = "";
            } else {
                var b = new mdc.textField.MDCTextField(document.querySelector('#yoursub-container'));
                valid = subm.length > 20;
                b.valid = subm.length > 20;
            }
            // if(!document.getElementById('agree').checked){
            //     valid = false;
            // }

            if(valid){
                // client side check for captcha WARNING: insecure
                if(grecaptcha.getResponse() == '') {
                    var captcha_dialog = new mdc.dialog.MDCDialog(document.querySelector('#not-robot-dialog'));
                    captcha_dialog.show();
                    return;
                }

                var confirm_dialog = new mdc.dialog.MDCDialog(document.querySelector('#confirm-submission-dialog'));
                confirm_dialog.show();
            }else{
                // show invalid dialog
                var incomplete_dialog = new mdc.dialog.MDCDialog(document.querySelector('#form-incomplete-dialog'));
                incomplete_dialog.show();
            }
        }

        function onSuccess() {
            // alert("Entry submitted.");
        }

        var group_selected = [false, false, false, false, false, false, false, false];

        function select_group(btn){
            // id of button clicked
            var gid = Number(btn.id[9])

            // array of colors
            // var colors = ["red", "orange", "yellow", "green", "blue", "purple", "pink", "brown"];
            var colors = ["orange", "red", "purple", "green", "blue", "pink", "yellow", "brown"];

            // array of color classes
            var cclass = colors[gid] + "-button";

            // change state
            group_selected[gid] = !group_selected[gid];

            // change button style
            if(group_selected[gid]){
                btn.classList.remove("mdc-button--outlined");
                btn.classList.add("mdc-button--raised");
            }else{
                btn.classList.remove("mdc-button--raised");
                btn.classList.add("mdc-button--outlined");
            }
        }

        function toggle_color(enabled){
            // array of colors
            // var colors = ["red", "orange", "yellow", "green", "blue", "purple", "pink", "brown"];
            var colors = ["orange", "red", "purple", "green", "blue", "pink", "yellow", "brown"];

            // change button style
            for(var i = 0; i < 8; i++){
                var btn = document.getElementById('group-btn' + i);
                if(enabled){
                    btn.classList.remove("purple-button");
                    btn.classList.add(colors[i] + '-button');
                }else{
                    btn.classList.remove(colors[i] + '-button');
                    btn.classList.add("purple-button");
                }
            }
        }

        function resetForm(){
            // reset text fields and their styles
            document.getElementById('yourname').value = "";
            var name = new mdc.textField.MDCTextField(document.querySelector('#yourname-container'));
            name.valid = true;
            document.getElementById('yoursub').value = "";
            var sub = new mdc.textField.MDCTextField(document.querySelector('#yoursub-container'));
            sub.valid = true;

            // clear file
            document.getElementById('file-upload1').value = "";
            uploadOnChange(document.getElementById('file-upload1'));

            // toggle all active items
            for(var i = 0; i < 8; i++){
                if(group_selected[i]){
                    select_group(document.getElementById('group-btn' + i));
                }
            }

            // uncheck the 'agree terms and conditions'
            // document.getElementById('agree').checked = false;

            // reset captcha
            grecaptcha.reset();
        }

        function sendForm() {
            // submit a big string instead of 8 booleans
            var groupnames = ["總副召", "美術組", "公關組", "影片組", "文宣組", "活動組", "音樂組", "其他人"]
            var gs = "";
            for (var i = 0; i < 8; i++) {
                if (group_selected[i]) {
                    gs += groupnames[i] + " ";
                }
            }
            if(gs == "") gs = "not specified";
            document.getElementById('groups').value = gs.trim();
            validate();
        }

        function submitForm() {
            // clear all fields
            resetForm();
            // scroll to top
            $("html, body").animate({ scrollTop: 0 }, "fast");
        }

        // client-side validation for the form
        function validate_funds(){
            var valid = true;
            var yourname = document.getElementById('yourname').value;
            var money = document.getElementById('money').value;
            var yoursub = document.getElementById('yoursub').value;
            if(yourname.trim() == "") valid = false;
            if(!isGoodMoney(money)) valid = false;
            if(yoursub.trim().length < 20) valid = false;
            if(!valid) {
                // show invalid dialog
                var incomplete_dialog = new mdc.dialog.MDCDialog(document.querySelector('#form-incomplete-dialog'));
                incomplete_dialog.show();
            } else {
                // client side check for captcha
                if(grecaptcha.getResponse() == '') {
                    var captcha_dialog = new mdc.dialog.MDCDialog(document.querySelector('#not-robot-dialog'));
                    captcha_dialog.show();
                } else {
                    var confirm_dialog = new mdc.dialog.MDCDialog(document.querySelector('#confirm-submission-dialog'));
                    confirm_dialog.show();
                }
            }
        }

        $(function() {
            // bind form and provide a simple callback function
            // $('#sub-form').ajaxForm(alert("meow"));
            //

        });

        $("#sub-form").submit(function(e) {
            e.preventDefault();

            showOverlay();


            var formData = new FormData(this);

            var sent = false;
            var timeout = false;

            setTimeout(function(){
                // if server didn't respond in 60 secs
                if(!sent){
                    submitForm();
                    closeOverlay();
                    document.getElementById('error-log').innerHTML = "Network timeout";
                    document.getElementById('status').innerHTML = document.getElementById('tmp-error').innerHTML;
                    timeout = true;
                }
            }, 60000);


            $.ajax({
                url: "process-submission.php",
                type: 'POST',
                data: formData,
                success: function (data) {
                    sent = true
                    if(timeout) return;
                    // $("#result").empty().append(data);
                    submitForm();
                    closeOverlay();
                    // alert(data);
                    if(data == '0'){
                        // show success nofification
                        document.getElementById('status').innerHTML = document.getElementById('tmp-success').innerHTML;
                    } else {
                        // print error log
                        var errmsg = "";
                        switch(data) {
                            case "1":
                            errmsg = "500 Internal Server Error. This is probably a server-side bug, please try again or contact the developer.";
                            break;
                            case "2":
                            errmsg = "Invalid input.";
                            break;
                            case "3":
                            errmsg = "Captcha not verified.";
                            break;
                            case "4":
                            errmsg = "There was an error while processing your file.";
                            break;
                            default:
                            errmsg = "Unknown Error. This is definitely a bug, please try again or contact the developer.";
                        }
                        document.getElementById('error-log').innerHTML = errmsg;
                        // show error nofification
                        document.getElementById('status').innerHTML = document.getElementById('tmp-error').innerHTML;
                    }
                },
                cache: false,
                contentType: false,
                processData: false
            });
        });

        $("#sub-formw").submit(function(event) {

            /* stop form from submitting normally */
            event.preventDefault();

            // show sending overlay
            showOverlay();

            /* get some values from elements on the page: */
            var $form = $(this);
            // term = $form.find('input[name="name"]').val(),
            // url = $form.attr('action');

            var sent = false;
            var timeout = false;

            setTimeout(function(){
                // if server didn't respond in 10 secs
                if(!sent){
                    submitForm();
                    closeOverlay();
                    document.getElementById('error-log').innerHTML = "Network timeout";
                    document.getElementById('status').innerHTML = document.getElementById('tmp-error').innerHTML;
                    timeout = true;
                }
            }, 10000);


            var subForm = document.getElementById('sub-form');
            var formData = new FormData(subForm);

            if(0){
                var xhr = new XMLHttpRequest();
                // Add any event handlers here...
                xhr.open('POST', 'process-submission.php', true);
                xhr.send(formData);
                sent=true;
                if(timeout) return;
                // $("#result").empty().append(data);
                submitForm();
                closeOverlay();
                alert(xhr.responseText);
                if(xhr.responseText == '0'){
                    // show success nofification
                    document.getElementById('status').innerHTML = document.getElementById('tmp-success').innerHTML;
                } else {
                    // print error log
                    var errmsg = "";
                    switch(xhr.responseText) {
                        case "1":
                        errmsg = "500 Internal Server Error. This is probably a server-side bug, please try again or contact the developer.";
                        break;
                        case "2":
                        errmsg = "Invalid input.";
                        break;
                        case "3":
                        errmsg = "Captcha not verified.";
                        break;
                        case "4":
                        errmsg = "There was an error while processing your file.";
                        break;
                        default:
                        errmsg = "Unknown Error. This is definitely a bug, please try again or contact the developer.";
                    }
                    document.getElementById('error-log').innerHTML = errmsg;
                    // show error nofification
                    document.getElementById('status').innerHTML = document.getElementById('tmp-error').innerHTML;
                }
                return;
            }



            /* Send the data using post */
            var posting = $.post("process-submission.php", $form.serialize());

            /* Put the results in a div */
            posting.done(function(data) {
                sent = true
                if(timeout) return;
                // $("#result").empty().append(data);
                submitForm();
                closeOverlay();
                if(data == '0'){
                    // show success nofification
                    document.getElementById('status').innerHTML = document.getElementById('tmp-success').innerHTML;
                } else {
                    // print error log
                    var errmsg = "";
                    switch(data) {
                        case "1":
                        errmsg = "500 Internal Server Error. This is probably a server-side bug, please try again or contact the developer.";
                        break;
                        case "2":
                        errmsg = "Invalid input.";
                        break;
                        case "3":
                        errmsg = "Captcha not verified.";
                        break;
                        case "4":
                        errmsg = "There was an error while processing your file.";
                        break;
                        default:
                        errmsg = "Unknown Error. This is definitely a bug, please try again or contact the developer.";
                    }
                    document.getElementById('error-log').innerHTML = errmsg;
                    // show error nofification
                    document.getElementById('status').innerHTML = document.getElementById('tmp-error').innerHTML;
                }
            });
        });
    </script>

</body>
</html>
